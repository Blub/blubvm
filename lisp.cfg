// Basically, lisp is good because you could do:
// ( echo "this is fun" ( get me a return value ) )

alias "(" "@lisp_expr ${* asis} )"

set %lisp_stack 0
set %lisp_token ""
set %lisp_retn ""
set %lisp_expr ""

// manage a stack of expressions
alias @lisp_push  "set %lisp_stack_${%lisp_stack} \"${%lisp_expr}\"; inc \"%lisp_stack\"; set \"%lisp_expr\" \"\""
alias @lisp_pop   "dec \"%lisp_stack\"; @_lisp_pop2"
alias @_lisp_pop2 "\"alias\" @_tmp \"set %lisp_expr \\\"$${%lisp_stack_${%lisp_stack}}\\\"\"; @_tmp; unalias \"@_tmp\""

alias @lisp_expr  "@lisp_push; @_lisp_expr ${* asis}; @lisp_pop"

alias @_lisp_expr      "set %lisp_token \"$1\"; set %lisp_action \"$1\"; toggle %lisp_action @_lisp_eat \"(\" @_lisp_subexpr \")\" @_lisp_end; @_lisp_next ${2- asis}"
alias @_lisp_next      "${%lisp_action} ${* asis}"
alias @_lisp_eat       "\"alias\" @_tmp \"set %lisp_expr \\\"${%lisp_expr} $${${%lisp_token}}\\\"\"; @_tmp; unalias @_tmp; @_lisp_expr ${* asis}"
alias @_lisp_eat       "set %lisp_expr \"${%lisp_expr} ${%lisp_token}\"; @_lisp_expr ${* asis}"
alias @_lisp_subexpr   "@lisp_expr ${* asis}; @_lisp_eatret; @_lisp_after_end"
alias @_lisp_eatret    "set %lisp_expr \"${%lisp_expr} ${%lisp_retn}\""
alias @_lisp_end       "echo \"${%lisp_expr}\"; ${%lisp_expr asis}; @_lisp_end2 ${* asis}"
alias @_lisp_end       "${%lisp_expr asis}; @_lisp_end2 ${* asis}"
alias @_lisp_end2      "set %lisp_retn \"$eax\"; set %lisp_token \"$*\""
alias @_lisp_after_end "@_lisp_expr ${%lisp_token asis}"

// some important functions:
alias get              "\"alias\" @_tmp  \"set eax $${$1}\"; @_tmp; unalias @_tmp"
alias quote            "\"alias\" @_tmpx \"${* asis}\"; @_tmpx; unalias @_tmpx"
